{%- assign u = include.url | default: '' -%}
{%- assign id = '' -%}

{%- if u != '' -%}
  {%- if u contains 'youtu.be/' -%}
    {%- assign id = u | split:'youtu.be/' | last | split:'?' | first | split:'&' | first | split:'#' | first -%}
  {%- elsif u contains '/embed/' -%}
    {%- assign id = u | split:'/embed/' | last | split:'?' | first | split:'&' | first | split:'#' | first -%}
  {%- elsif u contains '/shorts/' -%}
    {%- assign id = u | split:'/shorts/' | last | split:'?' | first | split:'&' | first | split:'#' | first -%}
  {%- elsif u contains 'v=' -%}
    {%- assign id = u | split:'v=' | last | split:'&' | first | split:'#' | first -%}
  {%- endif -%}
{%- endif -%}
{%- if id == '' and include.id -%}{%- assign id = include.id -%}{%- endif -%}

{%- assign params = 'rel=0' -%}
{%- if include.start and include.start != '' -%}
  {%- assign params = params | append:'&start=' | append:include.start -%}
{%- elsif u contains 't=' -%}
  {%- assign t = u | split:'t=' | last | split:'&' | first | split:'#' | first -%}
  {%- assign params = params | append:'&start=' | append:t -%}
{%- endif -%}

{%- assign w = include.w | default: include.width | default:'100%' -%}
{%- unless w contains 'px' or w contains '%' or w contains 'rem' or w contains 'vw' -%}
  {%- assign w = w | append:'px' -%}
{%- endunless -%}

{%- assign h = include.h | default: include.height | default:'' -%}
{%- if h != '' -%}
  {%- unless h contains 'px' or h contains '%' or h contains 'rem' or h contains 'vh' -%}
    {%- assign h = h | append:'px' -%}
  {%- endunless -%}
{%- endif -%}

{%- assign ratio = include.ratio | default:'16:9' -%}
{%- case ratio -%}
  {%- when '4:3'  -%}{%- assign pt = '75%' -%}
  {%- when '1:1'  -%}{%- assign pt = '100%' -%}
  {%- when '21:9' -%}{%- assign pt = '42.857%' -%}
  {%- when '3:2'  -%}{%- assign pt = '66.6667%' -%}
  {%- else -%}{%- assign pt = '56.25%' -%}  {# 16:9 #}
{%- endcase -%}

{%- if id != '' -%}
  {%- if h != '' -%}
<div class="my-6 rounded-xl overflow-hidden shadow mx-auto"
     style="width:{{ w }}; height:{{ h }}; position:relative;">
  <iframe style="position:absolute; inset:0; width:100%; height:100%;"
          src="https://www.youtube-nocookie.com/embed/{{ id }}?{{ params }}"
          title="{{ include.title | default:'YouTube video' }}" frameborder="0" loading="lazy"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen></iframe>
</div>
  {%- else -%}
<div class="my-6 rounded-xl overflow-hidden shadow mx-auto" style="width:{{ w }};">
  <div style="position:relative; width:100%; padding-top:{{ pt }};">
    <iframe style="position:absolute; inset:0; width:100%; height:100%;"
            src="https://www.youtube-nocookie.com/embed/{{ id }}?{{ params }}"
            title="{{ include.title | default:'YouTube video' }}" frameborder="0" loading="lazy"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            allowfullscreen></iframe>
  </div>
</div>
  {%- endif -%}
{%- else -%}
<!-- youtube include: no video id -->
{%- endif -%}
